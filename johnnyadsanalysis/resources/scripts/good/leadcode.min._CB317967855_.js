"use strict";if(!window.P){window.P={};P.register=function(t,e){window[t]=e();return e};P.when=function(){return{register:function(t,e){P.register(t,e)}}}}if(typeof String.prototype.capitalize!=="function"){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.toLowerCase().slice(1)}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(t,e){var i;if(this===null){throw new TypeError('"this" is null or not defined')}var r=new Object(this);var s=r.length;if(s===0){return-1}var n=+e||0;if(Math.abs(n)===Infinity){n=0}if(n>=s){return-1}i=Math.max(n>=0?n:s-Math.abs(n),0);while(i<s){if(i in r&&r[i]===t){return i}i++}return-1}}P.register("Cookie",function(){var t=t||{};t.write=function(t,e,i){if(!i){return false}if(typeof i==="number"){var r=new Date;r.setTime(r.getTime()+i*24*60*60*1e3);i=r}else if(i instanceof Date===false){return false}var s=t+"="+encodeURIComponent(e)+"; expires="+i+";path=/";document.cookie=s;return s};t.read=function(t){var e=document.cookie.split(";"),i=null;for(var r=0;r<e.length;r++){i=e[r].trim();if(i.indexOf(t)===0){i=i.substring(t.length+1,i.length);return decodeURIComponent(i)}}return null};t.destroy=function(e){t.write(e,"",new Date("Thu, 01 Jan 1970 00:00:01 UTC"));return document.cookie};return t});if(typeof String.prototype.regexpEscape!=="function"){String.prototype.regexpEscape=function(){return this.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}P.register("URI",function(){var t=function(){t.prototype.uri="";t.prototype.authority="";t.prototype.query="";t.prototype.fragment="";t.prototype.params=[];function t(t){this.uri="";if(t){this.set(t)}}t.prototype.set=function(e){if(e instanceof t){this.uri=e.uri}else{this.uri=e;this.fragment=this.getFragment();this.params=this.getParamsAsArray();this.authority=this.getAuthority();var i=null;this.uri=this.authority;for(var r=0;r<this.params.length;r++){i=this.params[r].split("=");this.addParam(decodeURIComponent(i[0]),decodeURIComponent(i[1]))}this.build()}return this};t.prototype.toString=function(){return this.uri};t.prototype.addParam=function(t,e,i){if(t){if(typeof e==="undefined"){e=""}var r=this.getParamsAsArray(),s=encodeURIComponent(t)+"="+encodeURIComponent(e);var n=this.getQueryParam(t);if(n&&i){this.removeParam(t);r=this.getParamsAsArray();r.push(s)}else if(!n){r.push(s)}this.query=this.buildQuery(r);this.build()}return this};t.prototype.removeParam=function(t){if(t){var e=this.getParamsAsArray();if(e&&e.length>0){for(var i=e.length-1;i>=0;i--){var r=e[i].split("=");if(decodeURIComponent(r[0]).match(t)){e.splice(i,1);1-6}}}this.query=this.buildQuery(e);this.build()}return this};t.prototype.setFragment=function(t){this.fragment=t;this.build()};t.prototype.getAuthority=function(){var t=this.uri.split("?")[0].trim();t=this.removeFragment(t);return t};t.prototype.getOrigin=function(){return this.uri.match(/([a-zA-Z]*:\/\/[a-zA-Z0-9.\-:]*)\/{1}/gi)[0]};t.prototype.getQuery=function(){var t=this.uri.split("?");if(t.length>1){return"?"+this.removeFragment(t[1])}return null};t.prototype.getFragment=function(){var t=this.uri.split("#");if(t.length>1){return"#"+t[1]}return""};t.prototype.removeFragment=function(t){return t.split("#")[0]};t.prototype.getQueryParamValue=function(t){if(t){var e=this.getQueryParam(t);if(e){return e[1]}}return null};t.prototype.getQueryParam=function(t){if(t){var e=this.getParamsAsArray();if(t instanceof RegExp===false){t=new RegExp("^"+t.regexpEscape()+"$")}if(e&&e.length>0){for(var i=0;i<e.length;i++){var r=e[i].split("=");if(decodeURIComponent(r[0]).match(t)){return[decodeURIComponent(r[0]),decodeURIComponent(r[1])]}}}}return null};t.prototype.getParamsAsArray=function(){var t=this.getQuery();if(t){t=t.substring(1);return t.split("&")}return[]};t.prototype.build=function(){this.uri=this.authority+this.query+this.fragment};t.prototype.buildQuery=function(t){var e="";if(typeof t==="object"&&t.length>0){e="?"+t.join("&")}return e};return t}();return t});P.when("URI","Cookie").register("LeadCode",function(t,e){if(!t){t=window.URI}if(!e){e=window.Cookie}var i=function(){function i(e){this.version="2.5.6";this.settings={prefix:"",marketingChannel:"",locale:"",product:"",defaultCode:"Default",appendix:"",overrideStaticLeadCode:true,ignoreCustomLeadCode:false,overrideExistingCookie:true,cookieExpireTime:15,srcOrder:["url","referrer","cookie"],hookBefore:function(){},hookAfter:function(){},hookUpdateCode:this.handleUrpCode,hookPrepareUrl:this.handleUrpUrls,leadCodeAttr:"ld",leadCodeCookieAttr:"ld",ignoreInternalUrls:true,restrictElemSearchTo:"body",autoRun:true,mappings:{},separator:"",debug:false,writeCookie:true};for(var i in e){if(typeof e[i]!=="undefined"){this.settings[i]=e[i]}}this.dataTrack=this.settings.leadCodeAttr+"-track";this.dataCustom=this.settings.leadCodeAttr+"-custom";this.dataStatic=this.settings.leadCodeAttr+"-static";this.dataPrepend=this.settings.leadCodeAttr+"-prepend";this.dataAppend=this.settings.leadCodeAttr+"-append";this.trackElements="a[href]:not([data-"+this.dataTrack+"=false]), "+"area:not([data-"+this.dataTrack+"=false]), "+"iframe[data-"+this.dataTrack+"=true], "+"option[data-"+this.dataTrack+"=true]";this.trackElementsLegacy="a, area";this.overrideSettingsDom="[data-"+this.settings.leadCodeAttr+"-overrides=true]";this.leadCode=null;this.findRegex=/#|\?|\&/;this.url=new t(location.href);this.referrerPrefix="EL";this.naturalSearchPrefix="NS";this.naturalSearchUrlList={google:"www\\.google\\.",bing:"www\\.bing\\.",yahoo:"\\.search\\.yahoo\\.",baidu:"www\\.baidu\\."};this.nomenclature={allowedSeparators:["_","-",".",""],defaultSeparator:""};if(typeof window.localStorage==="object"){this.localStorageExists=true}this.leadCodeAttrRegex=this.settings.leadCodeAttr+"|"+this.settings.leadCodeAttr.toUpperCase();this.replaceRegex="[^\\&^\\?.]*\\/?("+this.leadCodeAttrRegex+")$]?";this.readSettingsFromDom();this.validateSettings();this.validateSeparator();if(this.settings.debug){this.log("Script Version: "+this.version);if(typeof jQuery==="function"){this.log("jQuery is available.")}else{this.log("jQuery is NOT available. This lead code script might not find all targeted items. Please try to make jQuery available.","warn")}this.log("Settings:");this.log(this.settings);if(!this.settings.marketingChannel){this.log('marketingChannel is NOT set. It is recommended to set a prefix at any time to identify your own lead codes (Example: "AS")',"warn")}this.log("Mappings: The following code mappings are registered.");this.log(this.settings.mappings)}if(this.settings.autoRun){this.init()}}var r=i.prototype;r.init=function(){this.settings.hookBefore();this.getCode();this.setCode();this.settings.hookAfter()};r.validateSettings=function(){this.settings.marketingChannel=this.settings.marketingChannel.toUpperCase();this.settings.defaultCode=this.settings.defaultCode.capitalize();this.settings.locale=this.settings.locale.toUpperCase();this.settings.leadCodeAttr=this.settings.leadCodeAttr.toLowerCase()};r.validateSeparator=function(){if(this.nomenclature.allowedSeparators.indexOf(this.settings.separator)===-1){this.log('Unknown Lead Code separator "'+this.settings.separator+'". Switching to default separator "'+this.nomenclature.defaultSeparator+'"',"warn");this.settings.separator=this.nomenclature.defaultSeparator}};r.getCode=function(){for(var t=0;t<this.settings.srcOrder.length;t++){switch(this.settings.srcOrder[t].toLowerCase()){case"url":var e=this.extractLeadCodeFromUrl(this.url);if(e){this.leadCode=e}break;case"cookie":this.leadCode=this.getFromCookie();break;case"referrer":var i=this.getDocumentReferrer();if(this.isUrlExternal(i)){this.leadCode=this.getFromReferer()}else{this.log("Ignoring referrer step due to internal referral.")}break}if(this.leadCode){this.log("LeadCode found in "+this.settings.srcOrder[t]+' -> "'+this.settings.leadCodeAttr+'", "'+this.settings.leadCodeCookieAttr+'" -> '+this.leadCode);break}}if(!this.leadCode){this.leadCode=this.getDefault()}return this.leadCode};r.setCode=function(){var e,i,r=false;i=this.getElementsToBeTracked();for(var s=0;s<i.length;s++){var n=new t,a="";var o=this.getAttrNameFromNode(i[s]);n.set(i[s].getAttribute(o));r=this.unwrapRedirect(new t(n.toString()));if(r){n.set(r["location"])}var l=this.settings.hookUpdateCode(n);if(!this.settings.overrideStaticLeadCode){a=this.extractLeadCodeFromUrl(n);if(a){a=a}}n.set(this.removeStaticCodeFromUrl(n));a=this.handleCustomCodes(i[s],a);if(!a){a=this.leadCode}a=this.handleVariations(i[s],a);n.set(this.settings.hookPrepareUrl(n));n.addParam(l+this.settings.leadCodeAttr,a);if(r!==false){n.set(this.wrapRedirect(r,n))}i[s].setAttribute(o,n.toString());this.log("Set LeadCode on "+i[s].outerHTML+"\n   -> "+n.toString())}if(this.settings.writeCookie){this.writeCookie(this.leadCode)}else{this.log("Cookie was not set due to the setting.writeCookie being false.","warn")}};r.buildCode=function(t,e){var i;switch(e){case"natural":i=[this.naturalSearchPrefix,t.capitalize()];break;case"referrer":var r=t.split("/")[2];if(this.settings.separator===""){r="-"+r}i=[this.referrerPrefix,this.settings.locale,this.settings.product,r];break;case"standard":i=[this.settings.marketingChannel,this.settings.locale,this.settings.product,t];break;default:i=[this.settings.marketingChannel,this.settings.locale,this.settings.product,this.settings.defaultCode];break}return i.join(this.settings.separator)};r.readSettingsFromDom=function(){var t="data-"+this.settings.leadCodeAttr+"-",e=this.getDomElements(this.overrideSettingsDom,true);if(e.length){var i=e[0].attributes;for(var r=i.length-1;r>=0;r--){if(i[r].name.indexOf(t+"overrides")===-1){var s=i[r].name.replace(t+"setting-","");s=s.replace(/-([a-z])/g,function(t,e){return e.toUpperCase()});var n=this.handleTypeCast(i[r].value);this.settings[s]=n;this.log("Overridden DOM Setting: "+s+" = "+this.settings[s])}}}};r.removeStaticCodeFromUrl=function(t){t.removeParam(new RegExp(this.replaceRegex));return t};r.getElementsToBeTracked=function(){var e=this.trackElements,i=this.getDomElements(e);i=Array.prototype.slice.call(i);if(this.settings.ignoreInternalUrls){var r=null;for(var s=i.length-1;s>=0;s--){var n=this.getAttrNameFromNode(i[s]);r=new t(i[s].getAttribute(n));if(!(r.toString()&&this.isUrlExternal(r))){this.log("Remove URL ("+r.toString()+") from tracking list. It is an internal link.");i.splice(s,1)}}}return i};r.getAttrNameFromNode=function(t){var e="href";switch(t.nodeName){case"OPTION":e="value";break;case"IFRAME":e="src";break}return e};r.getDomElements=function(t,e){var i=[];if(typeof jQuery==="function"){i=jQuery(t)}else{if(typeof document.querySelectorAll==="function"){i=document.querySelectorAll(t)}else{if(!e){var r=this.trackElementsLegacy.split(",");i=[];for(var s=0;s<r.length;s++){i=i.concat(Array.prototype.slice.call(document.getElementsByTagName(r[s].trim())))}}}}return i};r.getDocumentReferrer=function(){return new t(document.referrer)};r.getLocationHost=function(){return new t(location.host)};r.isUrlExternal=function(t){var e=/^(http[s]?:)?\/\//;var i=t.toString().match(e)&&this.getLocationHost().toString()!==t.toString().replace(e,"").split("/")[0];if(!i){if(t.getAuthority().match(/redirect/)){i=t}}return i};r.unwrapRedirect=function(t){var e=t.getQueryParamValue("location"),i=false;if(e){i={};i["location"]=decodeURIComponent(e);t.removeParam("location");i["url"]=t}return i};r.wrapRedirect=function(t,e){t["url"].addParam("location",e);return t["url"]};r.extractLeadCodeFromUrl=function(t){return t.getQueryParamValue(new RegExp(this.leadCodeAttrRegex))};r.getFromCookie=function(){return e.read(this.settings.leadCodeCookieAttr)};r.writeCookie=function(t){var i=this.getFromCookie();if(!i||i&&this.settings.overrideExistingCookie){var r=e.write(this.settings.leadCodeCookieAttr,t,this.settings.cookieExpireTime);this.log("Cookie set: "+r)}};r.destroyCookie=function(){e.destroy(this.settings.leadCodeCookieAttr);this.log("Cookie destroyed")};r.handleCustomCodes=function(t,e){if(!this.settings.ignoreCustomLeadCode){var i=t.getAttribute("data-"+this.dataCustom);var r=t.getAttribute("data-"+this.dataStatic);if(r){i=r}if(i){return this.buildCode(i,"standard")}else{return e}}};r.getFromReferer=function(){var t=null,e=null,i=null,r=this.getDocumentReferrer().toString();if(r){for(var s in this.naturalSearchUrlList){if(typeof this.naturalSearchUrlList[s]!=="undefined"){e=new RegExp(this.naturalSearchUrlList[s],"i");if(r.match(e,"i")){i=s;break}}}if(i){t=this.buildCode(i,"natural")}else{t=this.buildCode(r,"referrer")}t=this.handleMappings(t)}return t};r.handleMappings=function(t){var e;for(var i in this.settings.mappings){if(t.indexOf(i.toLowerCase())>-1){e=this.settings.mappings[i];break}}if(e){t=this.buildCode(this.settings.mappings[i],"standard")}return t};r.getDefault=function(){var t=this.buildCode();t=this.handlePrefix(t,this.settings.prefix);t=this.handleAppendix(t,this.settings.appendix);this.log("Default LeadCode -> "+t);return t};r.handleVariations=function(t,e){var i=t.getAttribute("data-"+this.dataPrepend);if(!i){i=""}var r=t.getAttribute("data-"+this.dataAppend);if(!r){r=""}e=this.handlePrefix(e,i);e=this.handleAppendix(e,r);e=this.handlePrefix(e,this.settings.prefix);e=this.handleAppendix(e,this.settings.appendix);return e};r.handleAppendix=function(t,e){if(e){e=this.trimString(e);if(this.settings.separator===""){e="_"+e}else{e=this.settings.separator+e}if(t.indexOf(e)===-1){t+=e}}return t};r.handlePrefix=function(t,e){if(e){e=this.trimString(e);if(this.settings.separator===""){e+="_"}else{e+=this.settings.separator}if(t.indexOf(e)===-1){t=e+t}}return t};r.trimString=function(t){t=t.replace(/^[^a-zA-Z0-9]*/g,"");t=t.replace(/[^a-zA-Z0-9]*$/g,"");return t};r.handleUrpCode=function(t){if(t.toString().indexOf("passthrough")>-1){return"passthrough/"}return""};r.handleUrpUrls=function(t){return t.removeParam("passthrough(/|%2F)$")};r.handleTypeCast=function(t){if((parseInt(t,10)||0)===null){return parseInt(t,10)}if(t==="false"||t==="true"){return t==="true"?true:false}return t};r.debug=function(t){if(t){if(this.localStorageExists){localStorage.setItem("debug",true);this.log("Enabled Debugging.")}}else{if(this.localStorageExists){this.log("Disabled Debugging.");localStorage.removeItem("debug")}}};r.log=function(t,e){var i=false;if(this.localStorageExists){i=localStorage.getItem("debug")}if((this.settings.debug||i)&&typeof window.console==="object"){if(e==="warn"){console.warn("Warning: "+t)}else{console.log(t)}}};return i}();return i});